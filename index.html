<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#87CEEB" id="themeColor">
    <title>365 D√≠as de Luz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            transition: all 1s ease;
            overflow-x: hidden;
        }
        
        input[type="text"], input[type="date"], textarea {
            font-size: 16px !important;
        }
        
        button, .nav-btn {
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body.sunny {
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #FFF8DC 100%);
        }
        
        body.night {
            background: linear-gradient(180deg, #0B1026 0%, #1a237e 50%, #283593 100%);
        }
        
        body.rainy {
            background: linear-gradient(180deg, #4A5568 0%, #667eea 50%, #764ba2 100%);
        }
        
        .weather-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 100px;
            opacity: 0.7;
            animation: float-cloud 60s linear infinite;
        }
        
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 100px;
        }
        
        .cloud::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }
        
        .cloud::after {
            width: 60px;
            height: 60px;
            top: -30px;
            right: 10px;
        }
        
        @keyframes float-cloud {
            from { transform: translateX(-200px); }
            to { transform: translateX(calc(100vw + 200px)); }
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .sun {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 100px;
            height: 100px;
            background: #FFD700;
            border-radius: 50%;
            box-shadow: 0 0 60px #FFD700, 0 0 100px #FFA500;
            animation: pulse-sun 4s ease-in-out infinite;
        }
        
        @keyframes pulse-sun {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .moon {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 80px;
            height: 80px;
            background: #F0E68C;
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(240, 230, 140, 0.8);
        }
        
        .moon::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(240, 230, 140, 0.4);
            border-radius: 50%;
        }
        
        .raindrop {
            position: absolute;
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.8));
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        .lightning {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            opacity: 0;
            animation: flash 8s ease-in-out infinite;
        }
        
        @keyframes flash {
            0%, 90%, 92%, 100% { opacity: 0; }
            91% { opacity: 1; }
        }
        
        .widget-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 25px 20px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.8);
            position: relative;
            z-index: 10;
            transition: all 0.5s ease;
        }
        
        @media (max-width: 480px) {
            .widget-container {
                padding: 20px 15px;
                max-width: 95%;
            }
        }
        
        body.night .widget-container {
            background: rgba(30, 41, 59, 0.92);
            border: 2px solid rgba(71, 85, 105, 0.5);
        }
        
        body.rainy .widget-container {
            background: rgba(51, 65, 85, 0.92);
            border: 2px solid rgba(100, 116, 139, 0.5);
        }
        
        .hidden { display: none; }
        
        .login-emoji {
            font-size: 4em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            color: #1a1a1a;
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        body.night h1 { color: white; }
        body.rainy h1 { color: #f5f5f5; }
        
        .subtitle {
            color: #3d3d3d;
            font-style: italic;
            margin-bottom: 20px;
            font-size: 0.85em;
        }
        
        body.night .subtitle { color: rgba(255, 255, 255, 0.9); }
        body.rainy .subtitle { color: rgba(255, 255, 255, 0.85); }
        
        .input-group {
            text-align: left;
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            color: #2d2d2d;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        body.night .input-group label { color: white; }
        body.rainy .input-group label { color: #f0f0f0; }
        
        input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: white;
        }
        
        button {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .widget-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .day-number {
            font-size: 2.8em;
            color: #2d3748;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
        }
        
        body.night .day-number {
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
        }
        
        body.rainy .day-number {
            color: #93c5fd;
        }
        
        .date-display {
            color: #4a5568;
            font-size: 0.9em;
            text-transform: capitalize;
            font-weight: 500;
        }
        
        body.night .date-display { color: #cbd5e1; }
        body.rainy .date-display { color: #cbd5e1; }
        
        .weather-icon {
            font-size: 2.5em;
            margin: 15px 0;
            animation: float 3s ease-in-out infinite;
        }
        
        .message-box {
            background: linear-gradient(135deg, rgba(254, 202, 202, 0.4) 0%, rgba(252, 231, 243, 0.4) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(251, 207, 232, 0.5);
            padding: 25px 20px;
            border-radius: 25px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.15);
        }
        
        body.night .message-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            border: 2px solid rgba(129, 140, 248, 0.4);
        }
        
        body.rainy .message-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(99, 102, 241, 0.3) 100%);
            border: 2px solid rgba(96, 165, 250, 0.4);
        }
        
        .message-text {
            color: #1f2937;
            font-size: 1.1em;
            line-height: 1.7;
            font-weight: 600;
        }
        
        body.night .message-text { color: #e0e7ff; }
        body.rainy .message-text { color: #dbeafe; }
        
        .hashtag {
            display: block;
            margin-top: 12px;
            color: #ec4899;
            font-size: 0.85em;
            font-weight: 700;
        }
        
        body.night .hashtag { color: #a78bfa; }
        body.rainy .hashtag { color: #60a5fa; }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.5) 0%, rgba(139, 92, 246, 0.5) 100%);
            color: white;
            border: 2px solid rgba(167, 139, 250, 0.6);
            padding: 12px 18px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        
        .nav-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.6) 0%, rgba(167, 139, 250, 0.6) 100%);
        }
        
        .nav-btn:disabled {
            opacity: 0.4;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.5) 0%, rgba(100, 116, 139, 0.5) 100%);
        }
        
        .birthday-special {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .birthday-emoji { font-size: 3em; margin-bottom: 10px; }
        .birthday-text { color: white; font-size: 1.3em; font-weight: 700; }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .locked-message {
            color: #666;
            font-style: italic;
        }
        
        .reflection-box {
            background: rgba(255, 255, 255, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 18px;
            margin-top: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }
        
        body.night .reflection-box {
            background: rgba(44, 62, 80, 0.65);
            border: 3px solid rgba(52, 73, 94, 0.8);
        }
        
        body.rainy .reflection-box {
            background: rgba(71, 85, 105, 0.65);
            border: 3px solid rgba(100, 116, 139, 0.8);
        }
        
        .reflection-box label {
            display: block;
            color: #2d2d2d;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        body.night .reflection-box label { color: #FFA07A; }
        body.rainy .reflection-box label { color: #B8E1FF; }
        
        .reflection-box textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 0.9em;
            resize: vertical;
            min-height: 60px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .reflection-box textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: white;
        }
        
        /* Bloc de Notas */
        .notes-container {
            background: rgba(255, 255, 255, 0.85);
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        body.night .notes-container {
            background: rgba(44, 62, 80, 0.75);
            border: 3px solid rgba(52, 73, 94, 0.9);
        }
        
        body.rainy .notes-container {
            background: rgba(71, 85, 105, 0.75);
            border: 3px solid rgba(100, 116, 139, 0.9);
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }
        
        body.night .notes-header { border-bottom-color: rgba(255, 255, 255, 0.2); }
        body.rainy .notes-header { border-bottom-color: rgba(255, 255, 255, 0.2); }
        
        .notes-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        body.night .notes-header h3 { color: #fbbf24; }
        body.rainy .notes-header h3 { color: #93c5fd; }
        
        .add-note-btn {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        
        .add-note-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        
        .notes-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .notes-list::-webkit-scrollbar { width: 6px; }
        .notes-list::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; }
        .notes-list::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.5); border-radius: 10px; }
        
        .empty-notes {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
            padding: 30px 10px;
            font-size: 0.9em;
        }
        
        body.night .empty-notes { color: #cbd5e1; }
        body.rainy .empty-notes { color: #cbd5e1; }
        
        .note-item {
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(167, 139, 250, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        body.night .note-item {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(167, 139, 250, 0.4);
        }
        
        body.rainy .note-item {
            background: rgba(51, 65, 85, 0.6);
            border-color: rgba(147, 197, 253, 0.4);
        }
        
        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .note-title-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(167, 139, 250, 0.3);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            color: #2d3748;
            transition: all 0.3s ease;
        }
        
        body.night .note-title-input {
            background: rgba(30, 41, 59, 0.8);
            color: #e0e7ff;
        }
        
        body.rainy .note-title-input {
            background: rgba(51, 65, 85, 0.8);
            color: #dbeafe;
        }
        
        .note-title-input:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.6);
        }
        
        .note-actions { display: flex; gap: 5px; }
        
        .note-btn {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .note-btn:hover {
            transform: scale(1.1);
            background: rgba(239, 68, 68, 0.4);
        }
        
        .note-content {
            width: 100%;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(167, 139, 250, 0.2);
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9em;
            resize: vertical;
            min-height: 80px;
            color: #1f2937;
            font-family: inherit;
        }
        
        body.night .note-content {
            background: rgba(30, 41, 59, 0.7);
            color: #e0e7ff;
        }
        
        body.rainy .note-content {
            background: rgba(51, 65, 85, 0.7);
            color: #dbeafe;
        }
        
        .note-content:focus { outline: none; border-color: rgba(139, 92, 246, 0.5); }
        
        .subnotes-container {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed rgba(167, 139, 250, 0.3);
        }
        
        .subnote-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 8px;
        }
        
        body.night .subnote-item { background: rgba(30, 41, 59, 0.4); }
        body.rainy .subnote-item { background: rgba(51, 65, 85, 0.4); }
        
        .subnote-checkbox {
            cursor: pointer;
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }
        
        .subnote-text {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(167, 139, 250, 0.2);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #374151;
        }
        
        body.night .subnote-text {
            background: rgba(30, 41, 59, 0.8);
            color: #cbd5e1;
        }
        
        body.rainy .subnote-text {
            background: rgba(51, 65, 85, 0.8);
            color: #cbd5e1;
        }
        
        .subnote-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .subnote-text:focus { outline: none; border-color: rgba(139, 92, 246, 0.5); }
        
        .subnote-delete {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .subnote-delete:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: scale(1.1);
        }
        
        .add-subnote-btn {
            width: 100%;
            background: rgba(167, 139, 250, 0.2);
            border: 1px dashed rgba(167, 139, 250, 0.4);
            color: #8b5cf6;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
        }
        
        body.night .add-subnote-btn {
            background: rgba(167, 139, 250, 0.15);
            color: #a78bfa;
        }
        
        body.rainy .add-subnote-btn {
            background: rgba(147, 197, 253, 0.15);
            color: #60a5fa;
        }
        
        .add-subnote-btn:hover { background: rgba(167, 139, 250, 0.3); }
        
        /* Panel de diagn√≥stico */
        .debug-panel {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.75em;
            max-width: 90%;
            z-index: 999;
            font-family: monospace;
            line-height: 1.4;
            display: none;
        }
        
        .debug-panel.show {
            display: block;
        }
        
        .debug-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(139, 92, 246, 0.9);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .theme-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            border: 2px solid rgba(167, 139, 250, 0.3);
        }
        
        body.night .theme-selector {
            background: rgba(44, 62, 80, 0.95);
            border-color: rgba(167, 139, 250, 0.4);
        }
        
        body.rainy .theme-selector {
            background: rgba(71, 85, 105, 0.95);
            border-color: rgba(147, 197, 253, 0.4);
        }
        
        .theme-selector h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        body.night .theme-selector h4 { color: #fbbf24; }
        body.rainy .theme-selector h4 { color: #93c5fd; }
        
        .theme-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .theme-btn {
            padding: 8px 16px;
            border-radius: 10px;
            border: 2px solid rgba(167, 139, 250, 0.3);
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .theme-btn:hover {
            transform: scale(1.05);
            border-color: rgba(139, 92, 246, 0.6);
        }
        
        .theme-btn.active {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border-color: #8b5cf6;
        }
        
        /* Modal de Notas */
        .notes-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .notes-modal.show {
            display: flex;
        }
        
        .notes-modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.9);
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        body.night .notes-modal-content {
            background: rgba(30, 41, 59, 0.98);
            border: 3px solid rgba(52, 73, 94, 0.9);
        }
        
        body.rainy .notes-modal-content {
            background: rgba(51, 65, 85, 0.98);
            border: 3px solid rgba(100, 116, 139, 0.9);
        }
        
        .notes-modal-content::-webkit-scrollbar { width: 8px; }
        .notes-modal-content::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; }
        .notes-modal-content::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.5); border-radius: 10px; }
        
        .modal-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #ef4444;
            font-weight: bold;
        }
        
        .modal-close-btn:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: rotate(90deg) scale(1.1);
        }
        
        .open-notes-btn {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border: 2px solid rgba(167, 139, 250, 0.6);
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin: 15px auto 0;
            max-width: 200px;
        }
        
        .open-notes-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        
        @media (max-width: 480px) {
            .notes-modal-content {
                padding: 20px;
                max-height: 90vh;
            }
            
            .modal-close-btn {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body class="sunny">
    <div class="weather-effects" id="weatherEffects"></div>
    
    <!-- Bot√≥n de debug -->
    <button class="debug-toggle" onclick="toggleDebug()">üîß</button>
    
    <!-- Panel de diagn√≥stico -->
    <div class="debug-panel" id="debugPanel"></div>
    
    <!-- Modal de Notas -->
    <div class="notes-modal" id="notesModal" onclick="closeNotesModal(event)">
        <div class="notes-modal-content" onclick="event.stopPropagation()">
            <button class="modal-close-btn" onclick="closeNotesModal()">√ó</button>
            
            <div class="notes-container" style="background: transparent; border: none; padding: 0; margin: 0; box-shadow: none;">
                <div class="notes-header">
                    <h3>üìù Mis Notas</h3>
                    <button class="add-note-btn" onclick="addNewNote()">+ Nueva</button>
                </div>
                <div class="notes-list" id="notesList">
                    <div class="empty-notes">No hay notas para este d√≠a. ¬°Crea una nueva! üìù</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="widget-container">
        <div id="loginScreen">
            <div class="login-emoji">‚ú®</div>
            <h1>365 D√≠as de Luz</h1>
            <p class="subtitle">Un mensaje diario para iluminar tu vida</p>
            
            <div class="input-group">
                <label for="userName">Tu nombre:</label>
                <input type="text" id="userName" placeholder="Escribe tu nombre" required>
            </div>
            
            <div class="input-group">
                <label for="userBirthday">Tu cumplea√±os:</label>
                <input type="date" id="userBirthday" required>
            </div>
            
            <button onclick="login()">üéÅ Comenzar</button>
        </div>

        <div id="widgetScreen" class="hidden">
            <div class="widget-header">
                <div class="weather-icon" id="weatherIcon">‚òÄÔ∏è</div>
                <div class="day-number" id="dayNumber">D√≠a 1</div>
                <div class="date-display" id="dateDisplay"></div>
            </div>
            
            <div id="birthdaySpecial"></div>
            
            <div class="message-box">
                <p class="message-text" id="messageText"></p>
                <span class="hashtag" id="hashtag">#EresLuz</span>
            </div>

            <div class="reflection-box">
                <label>‚úçÔ∏è ¬øC√≥mo te sientes hoy?</label>
                <textarea id="reflectionText" placeholder="Escribe aqu√≠..."></textarea>
            </div>
            
            <button class="open-notes-btn" onclick="openNotesModal()">
                üìù Abrir Mis Notas
            </button>
            
            <div class="theme-selector">
                <h4>üé® Cambiar tema manualmente</h4>
                <div class="theme-buttons">
                    <button class="theme-btn" onclick="manualThemeChange('sunny')" id="btn-sunny">‚òÄÔ∏è Soleado</button>
                    <button class="theme-btn" onclick="manualThemeChange('rainy')" id="btn-rainy">üåßÔ∏è Lluvia</button>
                    <button class="theme-btn" onclick="manualThemeChange('night')" id="btn-night">üåô Noche</button>
                    <button class="theme-btn" onclick="manualThemeChange('auto')" id="btn-auto">ü§ñ Auto</button>
                </div>
            </div>
            
            <div class="navigation">
                <button class="nav-btn" onclick="previousDay()">‚Üê Anterior</button>
                <button class="nav-btn" onclick="showToday()">üìÖ Hoy</button>
                <button class="nav-btn" id="nextBtn" onclick="nextDay()">Siguiente ‚Üí</button>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button class="nav-btn" onclick="logout()" style="background: rgba(255, 100, 100, 0.3); font-size: 0.85em;">üö™ Cerrar Sesi√≥n</button>
            </div>
        </div>
    </div>

    <script>
        const WEATHER_API_KEY = '6f66e2afe270d596638eba65b13ceafe';
        
        let currentDate = new Date();
        let userData = null;
        let reflections = {};
        let currentWeather = 'sunny';
        let notes = {};
        let debugLogs = [];
        let manualTheme = null;
        
        function addDebugLog(message) {
            debugLogs.push(message);
            updateDebugPanel();
        }
        
        function updateDebugPanel() {
            const panel = document.getElementById('debugPanel');
            if (panel) {
                panel.innerHTML = debugLogs.slice(-15).join('<br>');
            }
        }
        
        function toggleDebug() {
            const panel = document.getElementById('debugPanel');
            panel.classList.toggle('show');
        }
        
        function manualThemeChange(theme) {
            if (theme === 'auto') {
                manualTheme = null;
                addDebugLog('ü§ñ Modo autom√°tico activado');
                detectWeather();
            } else {
                manualTheme = theme;
                addDebugLog('üëÜ Tema manual: ' + theme);
                applyWeatherTheme(theme);
            }
            updateThemeButtons();
        }
        
        function updateThemeButtons() {
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            if (manualTheme) {
                const btn = document.getElementById('btn-' + manualTheme);
                if (btn) btn.classList.add('active');
            } else {
                const btn = document.getElementById('btn-auto');
                if (btn) btn.classList.add('active');
            }
        }
        
        function loadSavedData() {
            const savedUser = localStorage.getItem('365luz_user');
            const savedReflections = localStorage.getItem('365luz_reflections');
            const savedNotes = localStorage.getItem('365luz_notes');
            
            if (savedUser) {
                userData = JSON.parse(savedUser);
                userData.birthday = new Date(userData.birthday);
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('widgetScreen').classList.remove('hidden');
                detectWeather();
                updateDisplay();
            }
            
            if (savedReflections) {
                reflections = JSON.parse(savedReflections);
            }
            
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
            }
        }
        
        function saveUserData() {
            localStorage.setItem('365luz_user', JSON.stringify(userData));
        }
        
        function saveReflections() {
            localStorage.setItem('365luz_reflections', JSON.stringify(reflections));
        }
        
        function saveNotes() {
            localStorage.setItem('365luz_notes', JSON.stringify(notes));
        }
        
        function logout() {
            if (confirm('¬øSeguro que quieres cerrar sesi√≥n?')) {
                localStorage.removeItem('365luz_user');
                localStorage.removeItem('365luz_reflections');
                localStorage.removeItem('365luz_notes');
                userData = null;
                reflections = {};
                notes = {};
                document.getElementById('widgetScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('userName').value = '';
                document.getElementById('userBirthday').value = '';
            }
        }
        
        function getCurrentDateKey() {
            return new Date(currentDate).toDateString();
        }
        
        function addNewNote() {
            const dateKey = getCurrentDateKey();
            if (!notes[dateKey]) {
                notes[dateKey] = [];
            }
            
            const newNote = {
                id: Date.now(),
                title: 'Nueva Nota',
                content: '',
                subnotes: []
            };
            
            notes[dateKey].push(newNote);
            saveNotes();
            renderNotes();
        }
        
        document.getElementById('reflectionText').addEventListener('input', function() {
            const dateKey = new Date(currentDate).toDateString();
            reflections[dateKey] = this.value;
            saveReflections();
        });
        
        function deleteNote(noteId) {
            const dateKey = getCurrentDateKey();
            if (confirm('¬øEliminar esta nota?')) {
                notes[dateKey] = notes[dateKey].filter(note => note.id !== noteId);
                saveNotes();
                renderNotes();
            }
        }
        
        function updateNoteTitle(noteId, newTitle) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                note.title = newTitle;
                saveNotes();
            }
        }
        
        function updateNoteContent(noteId, newContent) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                note.content = newContent;
                saveNotes();
            }
        }
        
        function addSubnote(noteId) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                note.subnotes.push({
                    id: Date.now(),
                    text: '',
                    completed: false
                });
                saveNotes();
                renderNotes();
            }
        }
        
        function deleteSubnote(noteId, subnoteId) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                note.subnotes = note.subnotes.filter(sn => sn.id !== subnoteId);
                saveNotes();
                renderNotes();
            }
        }
        
        function toggleSubnote(noteId, subnoteId) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                const subnote = note.subnotes.find(sn => sn.id === subnoteId);
                if (subnote) {
                    subnote.completed = !subnote.completed;
                    saveNotes();
                    renderNotes();
                }
            }
        }
        
        function updateSubnoteText(noteId, subnoteId, newText) {
            const dateKey = getCurrentDateKey();
            const note = notes[dateKey].find(n => n.id === noteId);
            if (note) {
                const subnote = note.subnotes.find(sn => sn.id === subnoteId);
                if (subnote) {
                    subnote.text = newText;
                    saveNotes();
                }
            }
        }
        
        function renderNotes() {
            const dateKey = getCurrentDateKey();
            const notesList = document.getElementById('notesList');
            const dayNotes = notes[dateKey] || [];
            
            if (dayNotes.length === 0) {
                notesList.innerHTML = '<div class="empty-notes">No hay notas para este d√≠a. ¬°Crea una nueva! üìù</div>';
                return;
            }
            
            notesList.innerHTML = dayNotes.map(note => `
                <div class="note-item">
                    <div class="note-header">
                        <input 
                            type="text" 
                            class="note-title-input" 
                            value="${note.title}" 
                            onchange="updateNoteTitle(${note.id}, this.value)"
                            placeholder="T√≠tulo de la nota">
                        <div class="note-actions">
                            <button class="note-btn note-delete-btn" onclick="deleteNote(${note.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <textarea 
                        class="note-content" 
                        onchange="updateNoteContent(${note.id}, this.value)" 
                        placeholder="Escribe aqu√≠ tu nota...">${note.content}</textarea>
                    
                    <div class="subnotes-container">
                        ${note.subnotes.map(subnote => `
                            <div class="subnote-item">
                                <input 
                                    type="checkbox" 
                                    class="subnote-checkbox" 
                                    ${subnote.completed ? 'checked' : ''}
                                    onchange="toggleSubnote(${note.id}, ${subnote.id})">
                                <input 
                                    type="text" 
                                    class="subnote-text ${subnote.completed ? 'completed' : ''}" 
                                    value="${subnote.text}" 
                                    onchange="updateSubnoteText(${note.id}, ${subnote.id}, this.value)"
                                    placeholder="Sub-tarea...">
                                <button class="subnote-delete" onclick="deleteSubnote(${note.id}, ${subnote.id})">√ó</button>
                            </div>
                        `).join('')}
                        <button class="add-subnote-btn" onclick="addSubnote(${note.id})">+ Sub-nota</button>
                    </div>
                </div>
            `).join('');
        }
        
        function openNotesModal() {
            document.getElementById('notesModal').classList.add('show');
            renderNotes();
        }
        
        function closeNotesModal(event) {
            if (event && event.target.className !== 'notes-modal') return;
            document.getElementById('notesModal').classList.remove('show');
        }
        
        const phrases = "Tu sonrisa tiene poder, √∫sala hoy.|üòä|No necesitas hacerlo perfecto, solo hacerlo con el coraz√≥n.|üíñ|Eres suficiente, incluso en tus d√≠as m√°s simples.|‚ú®|Hoy es un buen d√≠a para empezar de nuevo.|üåÖ|Cada paso peque√±o cuenta, no lo olvides.|üë£|La calma tambi√©n es progreso.|üåä|Tienes un brillo que nadie puede copiar.|‚≠ê|Lo que haces con amor siempre deja huella.|üíù|Respira, vas bien.|üå¨Ô∏è|No corras, las flores no florecen de prisa.|üå∏";
        
        const messages = phrases.split('|').reduce((acc, item, index, arr) => {
            if (index % 2 === 0 && arr[index + 1]) {
                acc.push({ text: item, icon: arr[index + 1] });
            }
            return acc;
        }, []);

        const hashtags = ["#EresLuz", "#D√≠aBrillante", "#MotivoDeAlegr√≠a", "#TuEsencia", "#Energ√≠aPositiva"];

        async function detectWeather() {
            if (manualTheme) {
                addDebugLog('‚ö†Ô∏è Tema manual activo: ' + manualTheme);
                return;
            }
            
            const hour = new Date().getHours();
            const now = new Date();
            
            addDebugLog('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            addDebugLog('üïê ' + now.toLocaleTimeString('es-ES'));
            addDebugLog('üìç Bel√©n, Heredia, CR');
            
            if (hour >= 20 || hour < 6) {
                addDebugLog('üåô Noche (hora: ' + hour + ')');
                applyWeatherTheme('night');
                return;
            }
            
            if (WEATHER_API_KEY && WEATHER_API_KEY !== '6f66e2afe270d596638eba65b13ceafe') {
                addDebugLog('üì° Consultando API...');
                try {
                    const latitude = 9.9881;
                    const longitude = -84.1811;
                    
                    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${WEATHER_API_KEY}&units=metric`;
                    
                    const response = await fetch(url);
                    addDebugLog('üì• Status: ' + response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        addDebugLog('‚ùå Error: ' + errorText.substring(0, 50));
                        throw new Error('API failed');
                    }
                    
                    const data = await response.json();
                    addDebugLog('‚úÖ Datos recibidos');
                    addDebugLog('üåç ' + data.name);
                    addDebugLog('üå°Ô∏è ' + data.main.temp.toFixed(1) + '¬∞C');
                    addDebugLog('üíß ' + data.main.humidity + '%');
                    
                    if (data.weather && data.weather.length > 0) {
                        const weatherCode = data.weather[0].id;
                        const weatherMain = data.weather[0].main;
                        const weatherDesc = data.weather[0].description;
                        
                        addDebugLog('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                        addDebugLog('‚òÅÔ∏è ' + weatherMain);
                        addDebugLog('üìù ' + weatherDesc);
                        addDebugLog('üî¢ C√≥digo: ' + weatherCode);
                        
                        const isRainy = weatherCode >= 200 && weatherCode < 600;
                        const hasRainText = weatherMain.toLowerCase().includes('rain') || 
                                          weatherMain.toLowerCase().includes('drizzle') || 
                                          weatherMain.toLowerCase().includes('thunderstorm');
                        
                        addDebugLog('üîç C√≥digo 200-599? ' + (isRainy ? 'S√ç' : 'NO'));
                        addDebugLog('üîç Texto lluvia? ' + (hasRainText ? 'S√ç' : 'NO'));
                        
                        if (isRainy || hasRainText) {
                            addDebugLog('üåßÔ∏è ‚úÖ LLUVIA!');
                            applyWeatherTheme('rainy');
                            return;
                        }
                        
                        addDebugLog('‚òÄÔ∏è Soleado');
                        applyWeatherTheme('sunny');
                        return;
                    }
                    
                } catch (error) {
                    addDebugLog('‚ö†Ô∏è Error: ' + error.message);
                }
            } else {
                addDebugLog('‚ùå Sin API Key');
            }
            
            addDebugLog('‚òÄÔ∏è Default: Soleado');
            applyWeatherTheme('sunny');
        }
        
        function applyWeatherTheme(weather) {
            currentWeather = weather;
            document.body.className = weather;
            addDebugLog('üé® Tema: ' + weather);
            
            const effectsContainer = document.getElementById('weatherEffects');
            effectsContainer.innerHTML = '';
            
            if (weather === 'sunny') {
                document.getElementById('themeColor').setAttribute('content', '#87CEEB');
                createSun(effectsContainer);
                createClouds(effectsContainer, 3);
            } else if (weather === 'night') {
                document.getElementById('themeColor').setAttribute('content', '#0B1026');
                createMoon(effectsContainer);
                createStars(effectsContainer, 50);
            } else if (weather === 'rainy') {
                document.getElementById('themeColor').setAttribute('content', '#4A5568');
                createRain(effectsContainer, 100);
                createLightning(effectsContainer);
                createClouds(effectsContainer, 5, true);
            }
            
            updateThemeButtons();
        }
        
        function createSun(container) {
            const sun = document.createElement('div');
            sun.className = 'sun';
            container.appendChild(sun);
        }
        
        function createMoon(container) {
            const moon = document.createElement('div');
            moon.className = 'moon';
            container.appendChild(moon);
        }
        
        function createStars(container, count) {
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }
        
        function createClouds(container, count, dark = false) {
            for (let i = 0; i < count; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.width = Math.random() * 100 + 80 + 'px';
                cloud.style.height = Math.random() * 40 + 30 + 'px';
                cloud.style.top = Math.random() * 30 + 10 + '%';
                cloud.style.left = -200 + 'px';
                cloud.style.animationDuration = Math.random() * 40 + 40 + 's';
                cloud.style.animationDelay = Math.random() * 20 + 's';
                if (dark) {
                    cloud.style.background = 'rgba(100, 100, 120, 0.6)';
                }
                container.appendChild(cloud);
            }
        }
        
        function createRain(container, count) {
            for (let i = 0; i < count; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = Math.random() * 0.5 + 0.5 + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(drop);
            }
        }
        
        function createLightning(container) {
            const lightning = document.createElement('div');
            lightning.className = 'lightning';
            container.appendChild(lightning);
        }
        
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 1);
            return Math.floor((date - start) / 86400000) + 1;
        }
        
        function isBirthday(date, birthdayDate) {
            const checkDate = new Date(date.getTime());
            const birthDate = new Date(birthdayDate.getTime());
            checkDate.setHours(12, 0, 0, 0);
            birthDate.setHours(12, 0, 0, 0);
            return checkDate.getMonth() === birthDate.getMonth() && checkDate.getDate() === birthDate.getDate();
        }
        
        function createConfetti() {
            const colors = ['#ff9a76', '#ffd700', '#ff69b4', '#87ceeb', '#98fb98', '#ffb6c1'];
            const shapes = ['‚óè', '‚ñ†', '‚ñ≤', '‚òÖ'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = Math.random() * 2 + 3 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 20);
            }
        }
        
        function login() {
            const name = document.getElementById('userName').value;
            const birthdayInput = document.getElementById('userBirthday').value;
            if (!name || !birthdayInput) return alert('Por favor completa todos los campos');
            
            const [year, month, day] = birthdayInput.split('-');
            const birthday = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), 12, 0, 0);
            
            userData = {name, birthday};
            saveUserData();
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('widgetScreen').classList.remove('hidden');
            detectWeather();
            updateDisplay();
        }
        
        function updateDisplay() {
            const today = new Date();
            today.setHours(0,0,0,0);
            const selected = new Date(currentDate);
            selected.setHours(0,0,0,0);
            
            const dayOfYear = getDayOfYear(currentDate);
            const message = messages[dayOfYear % messages.length];
            
            document.getElementById('dayNumber').textContent = `D√≠a ${dayOfYear}`;
            document.getElementById('dateDisplay').textContent = currentDate.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            if (currentWeather === 'sunny') {
                document.getElementById('weatherIcon').textContent = '‚òÄÔ∏è';
            } else if (currentWeather === 'night') {
                document.getElementById('weatherIcon').textContent = 'üåô';
            } else if (currentWeather === 'rainy') {
                document.getElementById('weatherIcon').textContent = 'üåßÔ∏è';
            }
            
            const dateKey = selected.toDateString();
            document.getElementById('reflectionText').value = reflections[dateKey] || '';
            
            const birthdaySpecial = document.getElementById('birthdaySpecial');
            
            if (userData && isBirthday(selected, userData.birthday)) {
                createConfetti();
                birthdaySpecial.innerHTML = `
                    <div class="birthday-special">
                        <div class="birthday-emoji">üéÇ</div>
                        <div class="birthday-text">¬°FELIZ CUMPLEA√ëOS ${userData.name.toUpperCase()}!</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: white;">üéâ Que todos tus sue√±os se hagan realidad ‚ú®</div>
                    </div>
                `;
            } else {
                birthdaySpecial.innerHTML = '';
            }
            
            if (selected > today) {
                document.getElementById('messageText').innerHTML = '<span class="locked-message">üîí Este mensaje estar√° disponible cuando llegue este d√≠a.</span>';
                document.getElementById('hashtag').textContent = '#ProntoLlegar√°';
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('reflectionText').disabled = true;
            } else {
                document.getElementById('messageText').textContent = message.text;
                document.getElementById('hashtag').textContent = hashtags[dayOfYear % hashtags.length];
                document.getElementById('reflectionText').disabled = false;
                
                const tomorrow = new Date(selected);
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('nextBtn').disabled = tomorrow > today;
            }
            
        renderNotes();
        }
        
        function showToday() {
            currentDate = new Date();
            detectWeather();
            updateDisplay();
        }
        
        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDisplay();
        }
        
        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDisplay();
        }
        
        setInterval(detectWeather, 600000);
        
        loadSavedData();
        
        if (!userData) {
            detectWeather();
        }
        
        updateThemeButtons();
    </script>
</body>
</html>
