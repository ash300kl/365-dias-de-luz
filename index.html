<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#87CEEB" id="themeColor">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="365 Días de Luz">
    <title>365 Días de Luz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            transition: all 1s ease;
            overflow: hidden;
        }
        
        /* TEMA DÍA SOLEADO */
        body.sunny {
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #FFF8DC 100%);
        }
        
        /* TEMA NOCHE */
        body.night {
            background: linear-gradient(180deg, #0B1026 0%, #1a237e 50%, #283593 100%);
        }
        
        /* TEMA LLUVIA */
        body.rainy {
            background: linear-gradient(180deg, #4A5568 0%, #667eea 50%, #764ba2 100%);
        }
        
        /* Efectos de clima */
        .weather-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        /* Nubes */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 100px;
            opacity: 0.7;
            animation: float-cloud 60s linear infinite;
        }
        
        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 100px;
        }
        
        .cloud::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }
        
        .cloud::after {
            width: 60px;
            height: 60px;
            top: -30px;
            right: 10px;
        }
        
        @keyframes float-cloud {
            from { transform: translateX(-200px); }
            to { transform: translateX(calc(100vw + 200px)); }
        }
        
        /* Estrellas */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        /* Sol */
        .sun {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 100px;
            height: 100px;
            background: #FFD700;
            border-radius: 50%;
            box-shadow: 0 0 60px #FFD700, 0 0 100px #FFA500;
            animation: pulse-sun 4s ease-in-out infinite;
        }
        
        @keyframes pulse-sun {
            0%, 100% { transform: scale(1); box-shadow: 0 0 60px #FFD700, 0 0 100px #FFA500; }
            50% { transform: scale(1.1); box-shadow: 0 0 80px #FFD700, 0 0 120px #FFA500; }
        }
        
        /* Luna */
        .moon {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 80px;
            height: 80px;
            background: #F0E68C;
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(240, 230, 140, 0.8);
            position: relative;
        }
        
        .moon::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(240, 230, 140, 0.4);
            border-radius: 50%;
        }
        
        /* Gotas de lluvia */
        .raindrop {
            position: absolute;
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.8));
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        /* Relámpago */
        .lightning {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            opacity: 0;
            animation: flash 8s ease-in-out infinite;
        }
        
        @keyframes flash {
            0%, 90%, 92%, 100% { opacity: 0; }
            91% { opacity: 1; }
        }
        
        /* Container del widget */
        .widget-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            transition: all 0.5s ease;
        }
        
        body.night .widget-container {
            background: rgba(26, 35, 126, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.rainy .widget-container {
            background: rgba(74, 85, 104, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .hidden { display: none; }
        
        /* Login screen */
        .login-emoji {
            font-size: 4em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            color: white;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 600;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            margin-bottom: 25px;
            font-size: 0.9em;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
        }
        
        .input-group {
            text-align: left;
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            color: white;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.9em;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: white;
        }
        
        button {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: white;
        }
        
        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        /* Widget content */
        .widget-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .day-number {
            font-size: 3em;
            color: white;
            font-weight: 700;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }
        
        .date-display {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
            text-transform: capitalize;
        }
        
        .weather-icon {
            font-size: 3em;
            margin: 20px 0;
            animation: float 3s ease-in-out infinite;
        }
        
        .message-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.5s ease;
        }
        
        .message-text {
            color: white;
            font-size: 1.1em;
            line-height: 1.6;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .hashtag {
            display: block;
            margin-top: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .nav-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .birthday-special {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .birthday-emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .birthday-text {
            color: white;
            font-size: 1.3em;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .locked-message {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }
        
        .reflection-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .reflection-box label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85em;
            margin-bottom: 8px;
        }
        
        .reflection-box textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 0.9em;
            resize: vertical;
            min-height: 60px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .reflection-box textarea:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: white;
        }
    </style>
</head>
<body class="sunny">
    <div class="weather-effects" id="weatherEffects"></div>
    
    <div class="widget-container">
        <div id="loginScreen">
            <div class="login-emoji">✨</div>
            <h1>365 Días de Luz</h1>
            <p class="subtitle">Un mensaje diario para iluminar tu vida</p>
            
            <div class="input-group">
                <label for="userName">Tu nombre:</label>
                <input type="text" id="userName" placeholder="Escribe tu nombre" required>
            </div>
            
            <div class="input-group">
                <label for="userBirthday">Tu cumpleaños:</label>
                <input type="date" id="userBirthday" required>
            </div>
            
            <button onclick="login()">🎁 Comenzar</button>
        </div>

        <div id="widgetScreen" class="hidden">
            <div class="widget-header">
                <div class="weather-icon" id="weatherIcon">☀️</div>
                <div class="day-number" id="dayNumber">Día 1</div>
                <div class="date-display" id="dateDisplay"></div>
            </div>
            
            <div id="birthdaySpecial"></div>
            
            <div class="message-box">
                <p class="message-text" id="messageText"></p>
                <span class="hashtag" id="hashtag">#EresLuz</span>
            </div>

            <div class="reflection-box">
                <label>✍️ ¿Cómo te sientes hoy?</label>
                <textarea id="reflectionText" placeholder="Escribe aquí..."></textarea>
            </div>
            
            <div class="navigation">
                <button class="nav-btn" onclick="previousDay()">← Anterior</button>
                <button class="nav-btn" onclick="showToday()">📅 Hoy</button>
                <button class="nav-btn" id="nextBtn" onclick="nextDay()">Siguiente →</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA TU API KEY DE OPENWEATHER AQUÍ
        const WEATHER_API_KEY = 'TU_API_KEY_AQUI';
        
        let currentDate = new Date();
        let userData = null;
        let reflections = {};
        let currentWeather = 'sunny';
        
        const phrases = "Tu sonrisa tiene poder, úsala hoy.|😊|No necesitas hacerlo perfecto, solo hacerlo con el corazón.|💖|Eres suficiente, incluso en tus días más simples.|✨|Hoy es un buen día para empezar de nuevo.|🌅|Cada paso pequeño cuenta, no lo olvides.|👣|La calma también es progreso.|🌊|Tienes un brillo que nadie puede copiar.|⭐|Lo que haces con amor siempre deja huella.|💝|Respira, vas bien.|🌬️|No corras, las flores no florecen de prisa.|🌸|Mereces todo lo bonito que estás buscando.|🌺|Lo que das, vuelve.|🔄|Eres más fuerte de lo que piensas.|💪|Tu energía cambia los lugares donde vas.|✨|Hoy elige verte con cariño.|💕|Lo estás intentando, y eso ya vale mucho.|🌟|No necesitas validación para ser valiosa.|👑|A veces descansar también es avanzar.|🛏️|Cada día puedes reinventarte un poco.|🦋|Eres luz, aunque no todos lo noten.|💡|Tu historia es única.|📖|Los días buenos llegan.|⏳|Agradece lo que tienes.|🙏|Elige la paz.|☮️|Tu voz importa.|🗣️|Has superado tanto.|🏔️|Lo mejor está por venir.|🎁|Sé tú misma.|🌈|El alma necesita descanso.|🌬️|Las cosas buenas toman tiempo.|⏰|Tu presencia es un regalo.|🎀|Sé amable contigo.|💗|No te castigues por sentir.|💙|Hoy puede enseñarte.|📚|Sigue adelante.|🐢|Los errores te fortalecen.|💎|No apagues tu luz.|💫|Tienes tanto por dar.|🎁|No necesitas claridad total.|🧭|Disfruta sin culpa.|🌻|Tu corazón sabe.|❤️|Sonríe hoy.|😊|Puedes cambiar.|🔄|Has llegado lejos.|🗺️|Tu bondad es fuerza.|🌟|No todo debe tener sentido.|🌙|Hoy cuenta.|🍃|Haz espacio para el bien.|🏡|Lo simple es hermoso.|🌿|Confía en el proceso.|🔮|Descansa.|😴|Elige ver lo bueno.|👀|El sol tarda en salir.|🌅|Eres capaz.|💪|No hay prisa.|🌷|Cada día es nuevo.|🌄|Lo estás haciendo bien.|🌟|Ya vales.|👑|Respira profundo.|🌬️|La ternura es fortaleza.|🌸|Has crecido.|🌱|Agradece.|🙏|Descansa si te cansas.|😌|Eres parte de algo bonito.|🌺|Estás avanzando.|🚶|Tu cuidado cuenta.|💞|Empezar de cero es valiente.|🔥|Mereces calma.|🕊️|Corazón valiente.|💖|Date crédito.|🏆|No necesitas producir.|✨|Eres suficiente en silencio.|🤫|La esperanza llega.|🌤️|Elige tu ritmo.|🎵|La bondad vuelve.|🔄|Algunas cosas se sienten.|💫|El mundo te sostiene.|🌍|Las victorias pequeñas importan.|🎉|Puedes soñar.|🌠|Cree en ti.|⭐|Eres capaz.|💪|No te exijas tanto.|🌼|Agradece tus pasos.|👣|Estás aprendiendo.|📚|Disfruta lento.|🐌|No necesitas todas las respuestas.|❓|Ya eres hermosa.|🌹|Suelta el control.|🎈|Mereces lo bueno.|💝|Celebra tus avances.|🎊|El tiempo enseña.|⏳|Sonríe más.|😊|Eres un proceso.|🔧|Tu ternura cambia.|🌎|Nadie más es tú.|✨|Mereces amor.|❤️|Eres diferente y brillante.|💎|No todo se mide.|📊|Siente orgullo.|🦁|Estás creciendo.|🌳|La calma llega.|🌊|No apagues tu entusiasmo.|🔥|Tus pasos son valientes.|👣|Puedes empezar otra vez.|🌅|Eres parte de algo grande.|🌌|Necesitar tiempo está bien.|⏰|Cada día te acerca.|🦋|Tus sueños merecen espacio.|💭|Eres luz.|💡|No controles todo.|🎮|Descansa sin culpa.|🛌|Tu esfuerzo vale.|🏅|Sé paciente contigo.|⏳|El amor florece.|🌻|Eres valiente.|🦸|El rumbo importa.|🧭|Eres constante.|⛰️|Descansar es sabio.|😌|No necesitas validación.|💫|Tu paz vale más.|☮️|Aprendes a quererte.|💗|La magia está en lo pequeño.|✨|Agradece lo simple.|🍂|Eres resiliente.|💪|Mira al cielo.|☁️|Lo haces bien.|👍|La felicidad se cultiva.|🌱|Confía en la vida.|🌈|Eres luz siempre.|🌥️|Tu ternura es regalo.|🎁|Cada día cuenta.|📆|No siempre debes ser fuerte.|🛡️|El descanso es parte.|🚶|Eres importante.|⭐|Suelta el peso.|🎈|El amor vuelve.|💕|Aprendes a vivir.|🌟|Tu forma de amar importa.|💖|Cree en lo bueno.|🌠|Eres valiente.|🦁|Vas bien.|🚶|La esperanza encuentra camino.|🌅|No necesitas plan perfecto.|📝|Estás donde debes.|📍|La vida es intentarlo.|🎯|No juzgues tus pausas.|⏸️|Tu corazón late.|💓|Elige calma.|🕊️|Hoy te fortalece.|💪|El cambio llega.|🌱|Comparte amor contigo.|💝|Estás floreciendo.|🌺|Confía en tu camino.|🛤️|Tu existencia es suficiente.|✨|Sé auténtica.|🌟|Eres historia hermosa.|📖|Simplemente sigue.|➡️|Abrázate con paciencia.|🤗|Lo haces bien.|👀|Cada día renace.|🌄|Eres capaz siempre.|💪|Sonríe.|😊|Cuida tu energía.|⚡|La bondad deja huella.|👣|Eres inspiración.|💫|Hoy siembras mañana.|🌷|Aprende a brillar.|✨|No subestimes tu crecimiento.|📈|Respira y sigue.|🌬️|Eres fuerte.|💪|El universo te recuerda.|🌌|Lo logras poco a poco.|🎯|Elige paz.|🔇|Eres increíble.|🌟|Todo tiene momento.|⏰|No te castigues.|🩹|Eres arte.|🎨|Déjate sorprender.|🎁|Eres luminosa.|✨|No pierdas la fe.|💭|Tu luz guía.|🔦|Haz algo bueno.|💚|Eres valiosa.|💎|Hoy te transforma.|🦋|Mereces suavidad.|☁️|Deja respirar tu alma.|🌬️|Eres suficiente.|✨|Ya tienes lo esencial.|💝|Date tiempo.|⏳|Te quieres con calma.|💗|La ternura es fuerza.|🌸|Tu ritmo es perfecto.|🎵|Eres luz siempre.|💡|Agradece lo que tienes.|🙏|Tu esencia es hermosa.|🌹|Lo haces lo mejor.|👏|Respira y confía.|🌬️|Eres milagro.|✨|Los sueños son reales.|🌠|Creces en silencio.|🌱|Elige ver bonito.|👁️|Tu paz es prioridad.|☮️|Disfruta el presente.|🎁|Alma fuerte y sensible.|💖|Da un paso más.|👣|Tu camino tiene sentido.|🛤️|Eres inspiración.|💫|Confía en tus decisiones.|✔️|Aprende a soltar.|🎈|Eres suficiente.|⭐|Celebra tu historia.|🎉|Descubre más.|🔍|Crea belleza.|🎨|Abraza emociones.|🤗|Estás sanando.|🩹|Tu esfuerzo se ve.|👀|Cree más en ti.|💪|Eres amor.|❤️|Lo bueno no duele.|🌈|Deja fluir.|🌊|Puedes lograrlo.|🏆|Eres única.|💎|Respira sin prisa.|🌬️|Eres bonita.|🌺|Todo mejora.|📈|Tu luz no depende del clima.|☀️|Aprendes a cuidarte.|💚|Date un momento.|🧘|Eres suficiente en pausa.|⏸️|No todo es perfecto.|🌸|Agradece avances.|📊|Eres fuerza en calma.|🌊|Elige amor.|💕|Creces con intentos.|🌱|Tu ternura cambia días.|🌼|Sonríe sin razón.|😊|Eres resiliente.|💪|Recuerda lo lejos.|🗺️|Déjate abrazar.|🤗|Vale la pena.|✨|Confía en el proceso.|🔄|Estás brillando.|💫|Eres amor en movimiento.|❤️|Date crédito.|🏅|Eres más que suficiente.|👑|Encuentra belleza simple.|🍃|Lo haces genial.|🌟|Eres esperanza.|🌅|Suelta culpa.|🎈|Eres paz.|☮️|Abrázate con cariño.|🤗|Eres parte grande.|🌌|Confía sin dudar.|💪|Tu alma merece descanso.|😴|Ve el lado bueno.|😊|Eres el sol.|☀️|No te exijas.|🌸|Eres hermosa siempre.|🌹|Siente sin miedo.|💙|Eres más capaz.|💪|Respira y suelta.|🌬️|Tu historia se construye.|🏗️|Agradece existir.|🙏|Eres amor.|❤️|Vales mucho.|💎|Aprendes a florecer.|🌺|Confía en fuerza.|💪|Corazón valiente.|🦁|Descansa sin culpa.|😌|Logras cosas grandes.|🏆|Busca calma dentro.|🧘|Eres luz llena.|✨|Sonríe a la vida.|😊|Haces lo correcto.|✔️|Cree en finales felices.|🌈|Eres luz para todos.|💡|Elige ternura.|💗|Eres suficiente siempre.|⭐|Aprecia lo que tienes.|🙏|Eres fuerza y dulzura.|🌸|Deja que esperanza guíe.|🌟|Eres buen recuerdo.|📸|Sé paciente.|⏳|Eres valiente aquí.|💪|Confía intuición.|🔮|Mereces amor verdadero.|💖|Agradece camino.|🛤️|Eres inspiración silenciosa.|🌙|Da paso con fe.|👣|Eres parte hermosa.|🌺|Puedes empezar otra vez.|🌅|Eres magia.|✨|Suelta lo viejo.|🎈|Eres alegría.|😊|Celebra existencia.|🎉|Eres constancia.|🌊|Todo pasa.|⏰|Eres más que errores.|⭐|Vive con gratitud.|🙏|Eres luz creyendo.|💡|Descansa.|🛌|Eres importante para alguien.|💝|Suelta miedo.|🎈|Eres historia evolutiva.|📖|Confía milagros.|✨|Eres suficiente sin condiciones.|💖|Cree posibilidades.|🌟|Eres parte buena.|🌈|Abraza lo que eres.|🤗|Eres fuerte que dudas.|💪|Elige amor todo.|❤️|Eres chispa esperanza.|✨|Disfruta lo haces.|😊|Eres capaz soñar.|🌠|Sé amable contigo.|💗|Eres luz tormenta.|⛈️|Agradece aprendido.|📚|Eres alma hermosa.|💫|Confía futuro.|🔮|Eres faro demás.|🗼|Respira sigue.|🌬️|Eres amor calma fuerza.|💪|No olvides sonreír.|😊|Eres resiliencia.|📖|Todo se acomoda.|🧩|Eres hermosa eres.|🌹|Ve bueno en ti.|👁️|Eres prueba luz vuelve.|🌅|Suelta pesa.|🎈|Eres sentido.|🌟|Celebra victorias.|🎊|Eres expansión.|🌌|Elige cuidarte.|💚|Eres todo necesitas.|✨|Mereces cosas buenas.|🎁|Eres fuerte miedos.|💪|Agradece presente.|🎁|Eres corazón amor.|❤️|Descansa sin remordimientos.|😴|Eres única especial.|💎|Sigue creyendo.|⭐|Eres calma buscas.|🌊|Confía tiempo.|⏰|Puedes volver empezar.|🌅|Deja vida fluir.|🌊|Eres digna amor.|💖|Agradece fuiste eres.|🙏|Eres promesa cumplida.|✅|Confía poder simple.|🍃|Eres abrazo mundo.|🤗|Deja espacio esperanza.|🌟|Eres recordatorio bondad.|💝|Vive ligereza.|🎈|Eres todo necesitas.|✨|Elige paz.|☮️|Eres valiente crees.|🦁|Confía proceso.|🔄|Eres amor humano.|💗|Sonríe lejos llegaste.|😊|Eres historia orgullo.|📖|Agradece por ti.|🙏|Eres prueba puede.|🏆|Todo saldrá bien.|🌈|Eres suficiente siempre serás.|⭐";
        
        const messages = phrases.split('|').reduce((acc, item, index, arr) => {
            if (index % 2 === 0 && arr[index + 1]) {
                acc.push({ text: item, icon: arr[index + 1] });
            }
            return acc;
        }, []);

        const hashtags = ["#EresLuz", "#DíaBrillante", "#MotivoDeAlegría", "#TuEsencia", "#EnergíaPositiva", "#ValorInterior", "#BrillaPorTi", "#TúImportas", "#AmorPropio", "#FuerzaInterior", "#CadaDíaCuenta", "#TúBrillas", "#AlmaHermosa", "#TuPresencia", "#EresMagia", "#TuVoz", "#CorazónValiente", "#EsenciaÚnica", "#TuSonrisa", "#GraciasPorSer"];

        // Detectar clima según la hora y API
        async function detectWeather() {
            const hour = new Date().getHours();
            
            // Modo nocturno automático (8pm - 6am)
            if (hour >= 20 || hour < 6) {
                applyWeatherTheme('night');
                return;
            }
            
            // Intentar obtener clima real si hay API key
            if (WEATHER_API_KEY !== 'TU_API_KEY_AQUI') {
                try {
                    const pos = await getCurrentPosition();
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?lat=${pos.latitude}&lon=${pos.longitude}&appid=${WEATHER_API_KEY}`
                    );
                    const data = await response.json();
                    
                    // Detectar si está lloviendo
                    const weatherCode = data.weather[0].id;
                    if (weatherCode >= 200 && weatherCode < 600) {
                        applyWeatherTheme('rainy');
                        return;
                    }
                } catch (error) {
                    console.log('No se pudo obtener el clima, usando modo soleado');
                }
            }
            
            // Por defecto: soleado
            applyWeatherTheme('sunny');
        }
        
        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation not supported'));
                } else {
                    navigator.geolocation.getCurrentPosition(
                        position => resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        }),
                        error => reject(error)
                    );
                }
            });
        }
        
        function applyWeatherTheme(weather) {
            currentWeather = weather;
            document.body.className = weather;
            
            const effectsContainer = document.getElementById('weatherEffects');
            effectsContainer.innerHTML = '';
            
            if (weather === 'sunny') {
                document.getElementById('themeColor').setAttribute('content', '#87CEEB');
                createSun(effectsContainer);
                createClouds(effectsContainer, 3);
            } else if (weather === 'night') {
                document.getElementById('themeColor').setAttribute('content', '#0B1026');
                createMoon(effectsContainer);
                createStars(effectsContainer, 50);
            } else if (weather === 'rainy') {
                document.getElementById('themeColor').setAttribute('content', '#4A5568');
                createRain(effectsContainer, 100);
                createLightning(effectsContainer);
                createClouds(effectsContainer, 5, true);
            }
        }
        
        function createSun(container) {
            const sun = document.createElement('div');
            sun.className = 'sun';
            container.appendChild(sun);
        }
        
        function createMoon(container) {
            const moon = document.createElement('div');
            moon.className = 'moon';
            container.appendChild(moon);
        }
        
        function createStars(container, count) {
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }
        
        function createClouds(container, count, dark = false) {
            for (let i = 0; i < count; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.width = Math.random() * 100 + 80 + 'px';
                cloud.style.height = Math.random() * 40 + 30 + 'px';
                cloud.style.top = Math.random() * 30 + 10 + '%';
                cloud.style.left = -200 + 'px';
                cloud.style.animationDuration = Math.random() * 40 + 40 + 's';
                cloud.style.animationDelay = Math.random() * 20 + 's';
                if (dark) {
                    cloud.style.background = 'rgba(100, 100, 120, 0.6)';
                    if (cloud.querySelector('::before')) cloud.querySelector('::before').style.background = 'rgba(100, 100, 120, 0.6)';
                    if (cloud.querySelector('::after')) cloud.querySelector('::after').style.background = 'rgba(100, 100, 120, 0.6)';
                }
                container.appendChild(cloud);
            }
        }
        
        function createRain(container, count) {
            for (let i = 0; i < count; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = Math.random() * 0.5 + 0.5 + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(drop);
            }
        }
        
        function createLightning(container) {
            const lightning = document.createElement('div');
            lightning.className = 'lightning';
            container.appendChild(lightning);
        }
        
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 1);
            return Math.floor((date - start) / 86400000) + 1;
        }
        
        function isBirthday(date, birthdayDate) {
            const checkDate = new Date(date.getTime());
            const birthDate = new Date(birthdayDate.getTime());
            checkDate.setHours(12, 0, 0, 0);
            birthDate.setHours(12, 0, 0, 0);
            return checkDate.getMonth() === birthDate.getMonth() && checkDate.getDate() === birthDate.getDate();
        }
        
        function createConfetti() {
            const colors = ['#ff9a76', '#ffd700', '#ff69b4', '#87ceeb', '#98fb98', '#ffb6c1'];
            const shapes = ['●', '■', '▲', '★'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = Math.random() * 2 + 3 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 20);
            }
        }
        
        function login() {
            const name = document.getElementById('userName').value;
            const birthdayInput = document.getElementById('userBirthday').value;
            if (!name || !birthdayInput) return alert('Por favor completa todos los campos');
            
            const [year, month, day] = birthdayInput.split('-');
            const birthday = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), 12, 0, 0);
            
            userData = {name, birthday};
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('widgetScreen').classList.remove('hidden');
            detectWeather();
            updateDisplay();
        }
        
        function updateDisplay() {
            const today = new Date();
            today.setHours(0,0,0,0);
            const selected = new Date(currentDate);
            selected.setHours(0,0,0,0);
            
            const dayOfYear = getDayOfYear(currentDate);
            const message = messages[dayOfYear - 1] || messages[0];
            
            document.getElementById('dayNumber').textContent = `Día ${dayOfYear}`;
            document.getElementById('dateDisplay').textContent = currentDate.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            // Icono según clima
            if (currentWeather === 'sunny') {
                document.getElementById('weatherIcon').textContent = '☀️';
            } else if (currentWeather === 'night') {
                document.getElementById('weatherIcon').textContent = '🌙';
            } else if (currentWeather === 'rainy') {
                document.getElementById('weatherIcon').textContent = '🌧️';
            }
            
            const dateKey = selected.toDateString();
            document.getElementById('reflectionText').value = reflections[dateKey] || '';
            
            const birthdaySpecial = document.getElementById('birthdaySpecial');
            
            if (userData && isBirthday(selected, userData.birthday)) {
                createConfetti();
                birthdaySpecial.innerHTML = `
                    <div class="birthday-special">
                        <div class="birthday-emoji">🎂</div>
                        <div class="birthday-text">¡FELIZ CUMPLEAÑOS ${userData.name.toUpperCase()}!</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: white;">🎉 Que todos tus sueños se hagan realidad ✨</div>
                    </div>
                `;
            } else {
                birthdaySpecial.innerHTML = '';
            }
            
            if (selected > today) {
                document.getElementById('messageText').innerHTML = '<span class="locked-message">🔒 Este mensaje estará disponible cuando llegue este día.</span>';
                document.getElementById('hashtag').textContent = '#ProntoLlegará';
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('reflectionText').disabled = true;
            } else {
                document.getElementById('messageText').textContent = message.text;
                document.getElementById('hashtag').textContent = hashtags[dayOfYear % hashtags.length];
                document.getElementById('reflectionText').disabled = false;
                
                const tomorrow = new Date(selected);
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('nextBtn').disabled = tomorrow > today;
            }
        }
        
        document.getElementById('reflectionText').addEventListener('input', function() {
            const dateKey = new Date(currentDate).toDateString();
            reflections[dateKey] = this.value;
        });
        
        function showToday() {
            currentDate = new Date();
            detectWeather();
            updateDisplay();
        }
        
        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDisplay();
        }
        
        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDisplay();
        }
        
        // Detectar clima cada 10 minutos
        setInterval(detectWeather, 600000);
        
        // Aplicar tema inicial
        detectWeather();
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .catch(err => console.log('Service Worker no disponible'));
            });
        }
    </script>
</body>
</html>
